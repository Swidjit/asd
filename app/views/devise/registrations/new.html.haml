= javascript_include_tag "http://maps.google.com/maps/api/js?v=3.13&sensor=false&libraries=places"
#map-canvas
.row
  .large-6.columns
    .login-form
      = form_for(resource, as: resource_name, url: registration_path(resource_name)) do |f|
        = devise_error_messages!
        %div
          = f.label :email
          = f.email_field :email, autofocus: true
        %div
          = f.label :username
          = f.text_field :username
        %div
          = f.label :first_name
          = f.text_field :first_name
          = f.label :last_name
          = f.text_field :last_name
        %div
          =f.label :city
          =f.text_field :address, :class => 'address'
          =f.hidden_field :latlng
        %div
          = f.label :password
          = f.password_field :password, autocomplete: "off"
        %div
          = f.label :password_confirmation
          = f.password_field :password_confirmation, autocomplete: "off"

        %div= f.submit "Sign up", :class => "button"
        = render "devise/shared/links"
:javascript
  $(document).on('ready page:load', function(){

    initialize();

  });

  var initialize;
  initialize = function() {
    var autocomplete, input, map, options;
    input = $('.address');
    options = {
      language: 'en-GB',
      center: new google.maps.LatLng(42.446877, -76.505407),
      zoom: 11
    };
    autocomplete = new google.maps.places.Autocomplete(input[0], options);
    map = new google.maps.Map(document.getElementById('map-canvas'), options);
    google.maps.event.addListener(autocomplete, 'place_changed', function() {
      var place = autocomplete.getPlace();
      console.log(place.geometry.location);
      $('#user_latlng').attr("value",place.geometry.location.k+","+place.geometry.location.B);

    })

    return google.maps.event.addListener(map, 'bounds_changed', function() {
      autocomplete.bindTo('bounds', map);
    });
  };